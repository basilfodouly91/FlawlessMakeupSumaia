<div class="container py-5">
    <!-- Category Header -->
    <div class="row mb-5" *ngIf="category">
        <div class="col-12">
            <div class="category-header text-center">
                <img [src]="category.imageUrl" [alt]="category.name" class="img-fluid rounded-3 shadow-lg mb-4"
                    style="max-height: 300px; object-fit: cover;">
                <h1 class="text-pink">{{ category.name }}</h1>
                <p class="lead text-muted">{{ category.description }}</p>
                <span class="badge bg-light-pink text-dark fs-6">{{ products.length }} {{ 'CATEGORY.PRODUCTS_COUNT' |
                    translate }}</span>
            </div>
        </div>
    </div>

    <!-- Products Grid -->
    <div class="row g-4" *ngIf="products.length > 0">
        <div class="col-lg-3 col-md-4 col-sm-6" *ngFor="let product of products">
            <div class="product-card card h-100 fade-in position-relative">
                <!-- Sale Badge -->
                <div class="sale-badge" *ngIf="product.hasDiscount">
                    {{ 'CATEGORY.SALE_BADGE' | translate }} {{ product.discountPercentage }}%
                </div>

                <!-- Sold Out Badge -->
                <div class="sold-out-badge" *ngIf="product.stockQuantity === 0">
                    {{ 'CATEGORY.SOLD_OUT_BADGE' | translate }}
                </div>

                <img [src]="product.imageUrl || 'https://picsum.photos/300/300?random=' + product.id"
                    [alt]="product.name" class="card-img-top" [routerLink]="['/product', product.id]"
                    style="cursor: pointer;">

                <div class="card-body d-flex flex-column">
                    <h6 class="card-title">
                        <a [routerLink]="['/product', product.id]" class="text-decoration-none text-dark">
                            {{ product.name }}
                        </a>
                    </h6>
                    <p class="card-text text-muted small flex-grow-1">{{ product.brand }}</p>

                    <div class="price-section mb-3">
                        <span class="product-price">{{ product.currentPrice | currency:'JOD':'symbol':'1.3-3' }}</span>
                        <span class="product-sale-price ms-2" *ngIf="product.hasDiscount">
                            {{ product.price | currency:'JOD':'symbol':'1.3-3' }}
                        </span>
                    </div>

                    <button class="btn btn-primary w-100" (click)="addToCart(product)"
                        [disabled]="product.stockQuantity === 0 || isAddingToCart[product.id]">
                        <span *ngIf="isAddingToCart[product.id]" class="spinner-border spinner-border-sm me-2"></span>
                        {{ product.stockQuantity === 0 ? ('CATEGORY.SOLD_OUT' | translate) : ('CATEGORY.ADD_TO_CART' |
                        translate) }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div class="text-center py-5" *ngIf="products.length === 0 && !isLoading">
        <i class="bi bi-box-seam fs-1 text-muted"></i>
        <h5 class="text-muted mt-3">{{ 'CATEGORY.NO_PRODUCTS' | translate }}</h5>
        <p class="text-muted">{{ 'CATEGORY.NO_PRODUCTS_MESSAGE' | translate }}</p>
        <a routerLink="/products" class="btn btn-primary">{{ 'CATEGORY.BROWSE_ALL' | translate }}</a>
    </div>

    <!-- Loading State -->
    <div class="text-center py-5" *ngIf="isLoading">
        <div class="spinner-border spinner-pink" role="status">
            <span class="visually-hidden">{{ 'CATEGORY.LOADING' | translate }}</span>
        </div>
    </div>
</div>